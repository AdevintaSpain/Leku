<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Leku - The Google maps picker for Android</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Location picker component for Android">
    <link href="static/bootstrap-combined.min.css" rel="stylesheet">
    <link href="static/app.css" rel="stylesheet">
    <link href="static/app-theme.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Roboto:400,300italic,100,100italic,300" rel="stylesheet" type="text/css">
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="static/html5shiv.min.js"></script><![endif]-->
</head>
<body data-target=".content-nav">
<header>
    <div class="container">
        <div class="row">
            <div class="span5">
                <img src="static/leku-logo.png" alt="Leku" />
            </div>
            <div class="span7">
                <menu>
                    <ul>
                        <li><a href="#download" class="menu download">Download <span class="version-tag">Latest</span></a></li>
                        <li><a href="https://github.com/SchibstedSpain/Leku" data-title="View GitHub Project" class="menu github"><img
                                src="static/icon-github.png" alt="GitHub"/></a></li>
                    </ul>
                </menu>
            </div>
        </div>
</header>
<section id="subtitle">
    <div class="container">
        <div class="row">
            <div class="span12">
                <h2>A <strong>map location picker component</strong> for Android</h2>
            </div>
        </div>
    </div>
</section>
<section id="body">
    <div class="container">
        <div class="row">
            <div class="span9">
                <h3 id="introduction">Introduction</h3>

                <p>Component library for Android that uses Google Maps and returns a latitude, longitude and an address based on the location picked with the Activity provided.</p>


                <h3 id="features">Features</h3>

                <img align="right" width="0" hspace="40"/>
                <img src="https://github.com/SchibstedSpain/Leku/blob/master/media/screenshot.gif?raw=true" align="right" />

                <ul>
                    <li>Search by voice</li>
                    <li>Search by text</li>
                    <li>Geo Location by GPS, network</li>
                    <li>Google Places</li>
                    <li>Pick locations using "touch" gestures on the map</li>
                    <li>Customization (Theme and layout)</li>
                    <li>Events Tracking</li>
                    <li>Multi-language support (English and Spanish supported by default)</li>
                    <li>RTL (Right-To-Left) layout support</li>
                </ul>

                <h3 id="using">Using Leku</h3>

                <h4>Permissions</h4>

                <p>You must add the following permissions in order to use the Google Maps Android API:</p>

                <ul>
                    <li><code>android.permission.INTERNET</code> - Used by the API to download map tiles from Google Maps servers.</li>
                    <li><code>android.permission.ACCESS_NETWORK_STATE</code> -  Allows the API to check the connection status in order to determine whether data can be downloaded.</li>
                </ul>

                <p>The following permissions are not required to use Google Maps Android API v2, but are recommended.</p>

                <ul>
                    <li><code>android.permission.ACCESS_COARSE_LOCATION</code> -  Allows the API to use WiFi or mobile cell data (or both) to determine the device's location. The API returns the location with an accuracy approximately equivalent to a city block.</li>
                    <li><code>android.permission.ACCESS_FINE_LOCATION</code> -  Allows the API to determine as precise a location as possible from the available location providers, including the Global Positioning System (GPS) as well as WiFi and mobile cell data.</li>
                    <li><code>android.permission.WRITE_EXTERNAL_STORAGE</code> -  Allows the API to cache map tile data in the device's external storage area.</li>
                </ul>

                <code>
                <uses-permission android:name="android.permission.INTERNET" />
                <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
                <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
                <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
                <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

                <uses-feature android:name="android.hardware.location.network" android:required="false" />
                <uses-feature android:name="android.hardware.location.gps" android:required="false"  />
                </code>

                <p>You must also explicitly declare that your app uses the <code>android.hardware.location.network</code> or <code>android.hardware.location.gps</code> hardware features if your app targets Android 5.0 (API level 21) or higher and uses the <code>ACCESS_COARSE_LOCATION</code> or <code>ACCESS_FINE_LOCATION</code> permission in order to receive location updates from the network or a GPS, respectively.</p>

                <p>**Note**: It supports runtime permissions for *Android 6 (Marshmallow)*. You don't need to do anything, it will ask for permissions if needed.</p>


                <h4>Usage</h4>

                <p>To use the <code>LocationPickerActivity</code> first you need to add these lines to your AndroidManifest file:</p>

                <pre class="prettyprint">
&lt;activity
        android:name="com.schibstedspain.leku.LocationPickerActivity"
        android:label="@string/leku_title_activity_location_picker"
        android:theme="@style/Theme.AppCompat.Light.NoActionBar"
        android:windowSoftInputMode="adjustPan"
        android:parentActivityName=".MainActivity">
    &lt;intent-filter>
        &lt;action android:name="android.intent.action.SEARCH" />
    &lt;/intent-filter>
    &lt;meta-data android:name="android.app.searchable"
               android:resource="@xml/leku_searchable" />
    &lt;meta-data
            android:name="android.support.PARENT_ACTIVITY"
            android:value=".MainActivity" />
&lt;/activity></pre>

                <p>Then you have setup the call to start this activity wherever you like, always as startActivityForResult.
                You can set a default location, search zone and other customizable parameters to load when you start the activity.
                You only need to use the Builder setters like:</p>

                <pre class="prettyprint">
Intent intent = new LocationPickerActivity.Builder()
.withLocation(41.4036299, 2.1743558)
.withGeolocApiKey("<PUT API KEY HERE>")
.withSearchZone("es_ES")
.shouldReturnOkOnBackPressed()
.withStreetHidden()
.withCityHidden()
.withZipCodeHidden()
.withSatelliteViewHidden()
.build(getApplicationContext());

startActivityForResult(intent, 1);</pre>

                <p>And add the response code from that activity:</p>

                <pre class="prettyprint">
@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
  if (requestCode == 1) {
    if(resultCode == RESULT_OK){
      double latitude = data.getDoubleExtra(LocationPickerActivity.LATITUDE, 0);
      Log.d("LATITUDE****", String.valueOf(latitude));
      double longitude = data.getDoubleExtra(LocationPickerActivity.LONGITUDE, 0);
      Log.d("LONGITUDE****", String.valueOf(longitude));
      String address = data.getStringExtra(LocationPickerActivity.LOCATION_ADDRESS);
      Log.d("ADDRESS****", String.valueOf(address));
      String postalcode = data.getStringExtra(LocationPickerActivity.ZIPCODE);
      Log.d("POSTALCODE****", String.valueOf(postalcode));
      Bundle bundle = data.getBundleExtra(LocationPickerActivity.TRANSITION_BUNDLE);
      Log.d("BUNDLE TEXT****", bundle.getString("test"));
      Address fullAddress = data.getParcelableExtra(LocationPickerActivity.ADDRESS);
      if(fullAddress != null)
      Log.d("FULL ADDRESS****", fullAddress.toString());
    }
    if (resultCode == RESULT_CANCELED) {
      //Write your code if there's no result
    }
  }
}</pre>

                That's all folks!


                <h4>Google Places</h4>

                <p>Leku now supports Google Places queries using the search box. If you want to enable it these are the steps you need to follow:

                1. You need to replace your old <code>com.google.android.maps.v2.API_KEY</code> meta-data for the <code>com.google.android.geo.API_KEY</code></p>

                <pre class="prettyprint">
&lt;!-- Use this if only using Maps and not Places
    &lt;meta-data
        android:name="com.google.android.maps.v2.API_KEY"
        android:value="@string/google_maps_key"
        />
-->

&lt;meta-data
        android:name="com.google.android.geo.API_KEY"
        android:value="@string/google_maps_key"/></pre>

                <p>2. Enable Google Places API for Android on your <a href="https://console.developers.google.com/">google developer console</a>.

                3. Enable it when instantiating <code>LocationPickerActivity</code> by adding <code>.withGooglePlacesEnabled()</code>:</p>

                <pre class="prettyprint">
Intent intent = new LocationPickerActivity.Builder()
**.withGooglePlacesEnabled()**
.build(getApplicationContext());</pre>

                And you are good to go. :)


                <h4>Localization</h4>

                <p>If you would like to add more language translations the only thing you have to do is:

                1. Crate a new strings resource folder and file for your language like <code>"/values-ru"</code>.
                2. Add all text translations for those strings:</p>

                <pre class="prettyprint">
&lt;string name="leku_title_activity_location_picker">Location Picker&lt;/string>
&lt;string name="leku_load_location_error">Something went wrong. Please try again.&lt;/string>
&lt;string name="leku_no_search_results">There are no results for your search&lt;/string>
&lt;string name="leku_unknown_location">unknown location&lt;/string>
&lt;string name="leku_voice_search_promp">Search by voice…&lt;/string>
&lt;string name="leku_voice_search_extra_language">en-EN&lt;/string>
&lt;string name="leku_toolbar_action_voice_title">Voice&lt;/string>
&lt;string name="leku_search_hint">Search&lt;/string></pre>

                <p>Note that you have the <code>voice_search_extra_language</code> that is used for the language of the voice recognition.
                Replace it with the allowed voice recognition locale for your language.

                I encourage you to add these languages to this component, please fork this project and submit new languages with a PR. Thanks!</p>


                <h4>Transition Bundle</h4>

                <p>If you need to send and receive a param through the LocationPickerActivity you can do it.
                You only need to add an "Extra" param to the intent like:</p>

                <pre class="prettyprint">
Intent intent = new Intent(getApplicationContext(), LocationPickerActivity.class);
intent.putExtra("test", "this is a test");
startActivityForResult(intent, 1);</pre>

                <p>And parse it on onActivityResult callback:</p>

                <pre class="prettyprint">
Bundle bundle = data.getBundleExtra(LocationPickerActivity.TRANSITION_BUNDLE);
String test = bundle.getString("test");</pre>

                <h4>Customization</h4>

                <h5>Theming</h5>

                <p>This library uses AppCompat, so should use Theme.AppCompat or descendant in manifest.</p>

                <pre class="prettyprint">
&lt;item name="colorPrimary">#E91E63&lt;/item>
&lt;item name="colorPrimaryDark">#C51162&lt;/item>
&lt;item name="colorAccent">#FBC02D&lt;/item>
&lt;item name="colorControlActivated">#E91E63&lt;/item></pre>

                > <code>colorControlActivated</code> is used to colorize Street title, if not set, it uses colorAccent by default

                <h5>Layout</h5>

                <p>It's possible to hide or show some of the information shown after selecting a location.
                Using tha bundle parameter <code>LocationPickerActivity.LAYOUTS_TO_HIDE</code> you can change the visibility of the street, city or the zipcode.</p>

                <pre class="prettyprint">
intent.putExtra(LocationPickerActivity.LAYOUTS_TO_HIDE, "street|city|zipcode");</pre>

                <h5>Search Zone</h5>

                <p>By default the search will be restricted to a zone determined by your default locale. If you want to force the search zone you can do it by adding this line with the locale preferred:</p>

                <pre class="prettyprint">
intent.putExtra(LocationPickerActivity.SEARCH_ZONE, "es_ES");</pre>

                <h5>Force return location on back pressed</h5>

                <p>If you want to force that when the user clicks on back button it returns the location you can use this parameter (note: is only enabled if you don't provide a location):</p>

                <pre class="prettyprint">
intent.putExtra(LocationPickerActivity.BACK_PRESSED_RETURN_OK, true);</pre>

                <h5>Enable/Disable the Satellite view</h5>

                <p>If you want to disable the satellite view button you can use this parameter (note: the satellite view is enabled by default):</p>

                <pre class="prettyprint">
intent.putExtra(LocationPickerActivity.ENABLE_SATELLITE_VIEW, false);</pre>

                <h5>Enable/Disable requesting location permissions</h5>

                <p>If you want to disable asking for location permissions (and prevent any location requests)</p>

                <pre class="prettyprint">
intent.putExtra(LocationPickerActivity.ENABLE_LOCATION_PERMISSION_REQUEST, false);</pre>

                <h4>Tracking</h4>

                <p>Optionally, you can set a tracking events listener. Implement LocationPickerTracker interface, and set it in your Application class as follows:</p>

                <pre class="prettyprint">
LocationPicker.setTracker(new <<YourOwnTracker implementing LocationPickerTracker>>());</pre>

                <p>Available tracking events are:</p>

                <ul>
                  <li><code>didLoadLocationPicker</code> - Location Picker</li>
                  <li><code>didSearchLocations</code> - Click on search for locations</li>
                  <li><code>didLocalizeMe</code> - Click on localize me</li>
                  <li><code>didLocalizeByPoi</code> - Long click on map</li>
                  <li><code>RESULT_OK</code> - Return location</li>
                  <li><code>CANCEL</code> - Return without location</li>
                </ul>

                <h4>Geocoding API Fallback</h4>

                <p>In few cases, the geocoding service from Android fails due to an issue with the NetworkLocator. The only way of fixing this is rebooting the device.</p>

                <p>In order to cover these cases, you can instruct Leku to use the Geocoding API. To enable it, just use the method <code>withGeolocApiKey</code> when invoking the LocationPicker.</p>

                <p>You should provide your Server Key as parameter. Keep in mind that the free tier only allows 2,500 requests per day. You can track how many times is it used in the Developer Console from Google.</p>

                <h4>Extra</h4>

                <p>If you would like to use the Geocoder presenter (MVP) used for this use case you are free to use it!
                GeocoderPresenter has three methods:</p>

                <ul>
                  <li>
                    <code>getLastKnownLocation:</code> Which obviously returns the last known user location as a ***Location*** object.
                  </li>

                  <li>
                    <code>getFromLocationName(String query):</code> Returns a <code>List&lt;Address></code> for the text introduced.
                  </li>

                  <li>
                    <code>getFromLocationName(String query, LatLng lowerLeft, LatLng upperRight):</code> Returns a <code>List&lt;Address></code> for the text and the Rectangle introduced.
                  </li>

                  <li>
                    <code>getDebouncedFromLocationName(String query, int debounceTime):</code> Returns a <code>List&lt;Address></code> for the text introduced. Useful if you want to implement your own search view with auto-complete.
                  </li>

                  <li>
                    <code>getDebouncedFromLocationName(String query, LatLng lowerLeft, LatLng upperRight, int debounceTime):</code> Returns a <code>List&lt;Address></code> for the text and the Rectangle introduced. Useful if you want to implement your own search view with auto-complete.
                  </li>

                  <li>
                    <code>getInfoFromLocation(double latitude, double longitude):</code> Returns a <code>List&lt;Address></code> based on a latitude and a longitude.
                  </li>
              </ul>

                <p>To use it first you need to implement the GeocoderViewInterface interface in your class like:</p>

                <pre class="prettyprint">
public class LocationPickerActivity extends AppCompatActivity implements GeocoderViewInterface {</pre>

                <p>Then you need to setup the presenter:</p>

                <pre class="prettyprint">
private GeocoderPresenter geocoderPresenter;

@Override protected void onCreate(Bundle savedInstanceState) {
  super.onCreate(savedInstanceState);
  ***
  GooglePlacesDataSource placesDataSource = new GooglePlacesDataSource(Places.getGeoDataClient(this, null));
  Geocoder geocoder = new Geocoder(this, Locale.getDefault());
  apiInteractor = new GoogleGeocoderDataSource(new NetworkClient(), new AddressBuilder());
  GeocoderRepository geocoderRepository = new GeocoderRepository(new AndroidGeocoderDataSource(geocoder), apiInteractor);
  geocoderPresenter = new GeocoderPresenter(new ReactiveLocationProvider(getApplicationContext()), geocoderRepository, placesDataSource);
  geocoderPresenter.setUI(this);
  ***
}</pre>

                <p>And besides filling the interface methods you have to add some things to your activity/fragment lifecycle to ensure that there are no leaks.</p>

                <pre class="prettyprint">
@Override
protected void onStart() {
  super.onStart();
  geocoderPresenter.setUI(this);
}

@Override
protected void onStop() {
  geocoderPresenter.stop();
  super.onStop();
}</pre>

                <h5>Tests</h5>

                <p>Note: If you need to execute the Espresso test you will need to add the Google Maps Key into the Tests AndroidManifest.xml</p>


                <p>Now you have all you need. :)</p>


                <h5>Important</h5>

                <p>Searching using the "SearchView" (geocoder) will be restricted to a zone if you are with a Locale from: US, UK, France, Italy and Spain. If not, the search will return results from all the world.</p>


                <h4>Sample usage</h4>

                <p>We provide a sample project which provides runnable code samples that demonstrate their use in Android applications.
                Note that you need to include your Google Play services key in the sample to be able to test it.</p>

                <h3 id="download">Download</h3>
                <p><a href="https://search.maven.org/remote_content?g=com.schibstedspain.android&a=leku&v=LATEST"
                      class="dl core-version-href">&darr; <span class="version-tag">Latest</span> AAR</a></p>
                <p>The source code to Leku, its samples, and this website is <a href="https://github.com/SchibstedSpain/leku">available on
                    GitHub</a>.</p>

                <h4>Maven</h4>
                <pre class="prettyprint">&lt;dependency>
  &lt;groupId>com.schibstedspain.android&lt;/groupId>
  &lt;artifactId>leku&lt;/artifactId>
  &lt;version><span class="version pln"><em>4.0.0</em></span>&lt;/version>
&lt;/dependency></pre>

                <h4>Gradle</h4>
                <pre class="prettyprint">implementation 'com.schibstedspain.android:leku:<span
                        class="version pln"><em>4.0.0</em></span>'</pre>

                <h3 id="contributing">Contributing</h3>
                <p>If you would like to contribute code you can do so through GitHub by forking the repository and sending a pull request.</p>
                <p>When submitting code, please make every effort to follow existing conventions and style in order to keep the code as readable as possible.</p>
                <br/>
                <ul>
                    <li>1. Create an issue to discuss about your idea</li>
                    <li>2. <a href="https://github.com/SchibstedSpain/leku/fork">Fork it</a></li>
                    <li>3. Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
                    <li>4. Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
                    <li>5. Push to the branch (<code>git push origin my-new-feature</code>)</li>
                    <li>6. Create a new Pull Request</li>
                    <li>7. Profit! <i class="em em-white_check_mark"></i></li>
                </ul>

                <h3 id="license">License</h3>
                <pre>Copyright 2016 Schibsted Classified Media Spain S.L.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</pre>
            </div>
            <div class="span3">
                <div class="content-nav" data-spy="affix" data-offset-top="80">
                    <ul class="nav nav-tabs nav-stacked primary">
                        <li><a href="#introduction">Introduction</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#using">Using Leku</a></li>
                        <li><a href="#download">Download</a></li>
                        <li><a href="#contributing">Contributing</a></li>
                        <li><a href="#license">License</a></li>
                    </ul>
                    <ul class="nav nav-pills nav-stacked secondary">
                        <li><a href="http://stackoverflow.com/questions/tagged/leku?sort=active">StackOverflow</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="span12 logo">
                <a href="https://www.schibsted.com"><img src="static/schibsted-logo.png" alt="Schibsted Classified Media Spain S.L."/></a>
            </div>
        </div>
    </div>
</section>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="static/bootstrap.min.js"></script>
<script src="static/jquery.smooth-scroll.min.js"></script>
<script src="static/jquery-maven-artifact.min.js"></script>
<script src="static/prettify.js"></script>
<script type="text/javascript">
      $(function() {
        // Syntax highlight code blocks.
        prettyPrint();

        // Spy on scroll position for real-time updating of current section.
        $('body').scrollspy();

        // Use smooth-scroll for internal links.
        $('a').smoothScroll();

        // Enable tooltips on the header nav image items.
        $('.menu').tooltip({
          placement: 'bottom',
          trigger: 'hover',
          container: 'body',
          delay: {
            show: 500,
            hide: 0
          }
        });

        // Look up the latest version of the library.
        $.fn.artifactVersion('com.schibstedspain.android', 'leku', function(version, url) {
          $('.version').text(version);
          $('.version-tag').text('v' + version);
          $('.core-version-href').attr('href', url);
        });
      });

</script>
</body>
</html>
